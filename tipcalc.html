<!DOCTYPE html>
<html lang="en">
  <head>
    <link href="css/tipCalc.css" rel="stylesheet" />
  </head>
  <body>
    <script>
      function myFunction() {
        var x = document.getElementById("frm1");
        var text = "";
        var i;
        for (i = 0; i < x.length; i++) {
          text += x.elements[i].value + "<br>";
        }
        document.getElementById("demo").innerHTML = text;
      }

      function setTipPercent(value) {
        document.getElementById("tipPercentInput").value = value;
        calculateTotal();
      }

      function setNewTipPercent(value) {
        document.getElementById("newTipPercentInput").value = value;
        document.getElementById("customTipInput").value = "";
        calculateNewTipAndTotal();
      }

      function calculateTotal() {
        const percent = document.getElementById("tipPercentInput").value;
        const value = document.getElementById("tipDollarValue").value || 1;
        const tax = document.getElementById("tax").value * 1.0;
        const realPercent = percent * 0.01;
        const calcTotal = (value * 1.0) / realPercent;
        const totalLessTax = calcTotal - tax;
        document.getElementById("calculatedTotal").value = totalLessTax.toFixed(
          2
        );
        calculateNewTipAndTotal();

        if (tax > 0 && value > 1 && percent > 0) {
          const explainText = `(${calcTotal.toFixed(2)} - ${tax})`;
          document.getElementById("totalExplain").innerHTML = explainText;
        } else {
          document.getElementById("totalExplain").innerHTML = "";
        }
      }

      const formatter = new Intl.NumberFormat("en-US", {
        style: "currency",
        currency: "USD",
      });

      function roundTip() {
        const currentTip = document.getElementById("newTipPercentInput").value;

        if (currentTip) {
          const roundedTip = Math.round(currentTip);
          document.getElementById("customTipInput").value = roundedTip;
          calculateNewTipAndTotal();
        }
      }

      function calculateNewTipAndTotal() {
        var dollarTip = 0;
        const total = document.getElementById("calculatedTotal").value * 1.0;

        if (document.getElementById("customTipInput").value) {
          dollarTip = document.getElementById("customTipInput").value;
        } else {
          const newTipPercent =
            document.getElementById("newTipPercentInput").value || 0;
          const newTipReal = newTipPercent * 0.01;
          dollarTip = newTipReal * total;
        }

        document.getElementById("newTipAmount").innerHTML = formatter.format(
          dollarTip
        );

        document.getElementById("newTotal").innerHTML = formatter.format(
          dollarTip * 1.0 + total * 1.0
        );
      }
    </script>
    <div class="wrapper">
      <div class="section">
        <h3>Preset Tip</h3>
        <div class="row three">
          <button onclick="setTipPercent(20)">20</button>
          <button onclick="setTipPercent(23)">23</button>
          <button onclick="setTipPercent(25)">25</button>
        </div>
        <div class="row">
          <div class="column">
            <label class="quiet" for="tipPercentInput">Tip %</label>
            <input
              type="tel"
              class="quiet"
              id="tipPercentInput"
              onchange="calculateTotal()"
            />
          </div>
        </div>
        <div class="row two">
          <div class="column">
            <label class="dollar" for="tipDollarValue">Tip $</label>
            <input
              class="dollar"
              type="tel"
              id="tipDollarValue"
              onchange="calculateTotal()"
            />
          </div>
          <div class="column">
            <label class="negative" for="tax">Tax</label>
            <input
              type="tel"
              class="negative"
              id="tax"
              value="0"
              onchange="calculateTotal()"
            />
          </div>
        </div>
      </div>
      <br />
      <div class="row two">
        <div class="column">
          <label class="dollar" for="calculatedTotal">Total</label>
          <input
            type="tel"
            class="dollar"
            id="calculatedTotal"
            onchange="calculateNewTipAndTotal()"
          />
        </div>
        <div id="totalExplain" class="explain"></div>
      </div>
      <div class="row three">
        <button onclick="setNewTipPercent(15)">15</button>
        <button onclick="setNewTipPercent(18)">18</button>
        <button onclick="setNewTipPercent(20)">20</button>
      </div>
      <div class="row two">
        <div class="column">
          <label class="dollar" for="newTipPercentInput">Custom Tip $</label>
          <input
            class="dollar"
            type="tel"
            id="customTipInput"
            onchange="calculateNewTipAndTotal()"
          />
        </div>
        <div class="column">
          <label for="newTipPercentInput">New Tip %</label>
          <input
            type="tel"
            id="newTipPercentInput"
            onchange="calculateTotal()"
          />
        </div>
      </div>
      <div class="row two">
        <div class="column highlight">
          <label for="newTipAmount">New Tip $</label>
          <div class="dollarDisplay" id="newTipAmount"></div>
          <br />
          <button class="small" onclick="roundTip()">Round</button>
        </div>
        <div class="column primary">
          <label for="newTotal">New Total $</label>
          <div class="dollarDisplay" id="newTotal"></div>
        </div>
      </div>
    </div>
  </body>
</html>
